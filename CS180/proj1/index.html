<!DOCTYPE html>
<html>
<head>
    <title>My Portfolio</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <h1>Project 1</h1>
    <h2>Single-scale alignment</h2>
        <p>
            The first task was trying to figure out image alignment. This is so that the blue, red, and green channels sit on top of each other in a way that makes a cohesive picture.
            For this, I chose blue as my base channel, and aligned my red and green channels to it. 
            For the single-scale alignment case, I decided to do the alignment based on pixel intensity, because it seemed that all three color channels had roughly the same pixel intensity at the spots they were supposed to align at.
            I used the normalized cross corralation metric on the pixel intensities to align the photos. Here is the formula from the class slides. Intuitively, what this does is measuree how similar the two images are. So the higher the cross correlation, the better.
        </p>
        <img src="./webpage images/NCC.png" style="display: block; margin: 0 auto; max-width: 30%; height: auto;">
        <p>
            I decided to only bother aligning the middle 40% of the image to save computational time. This was not neccessary for the single-scale alignment case, but became important when I had to align bigger pictures in the multi-scale alignment case. 
            One issue that I ran into when aligning was trying to figure out what to do with the "ledge" of the image as I slide one image over the other. Obviously, we can not take a dot product (which is important for a cross correlation) of two matrices if their corners are not lined up. To solve this, I used the np.roll() function as per the project websites suggestion.
            However, then came the issue of not wanting to deal with the "overflow". Although np.roll did line up the corners of the images so that taking a dot product is possible, it did this by pushing the "ledge" back to the otherside of the image. That would have messed up my NCC measurements. To solve this, I used a masking matrix on top of the image that was sliding on top of the base image. What this masking matrix did is set all values in the "border" of the sliding image to zero, where the border is chosen to be thick enough such that a nonzero value will never roll over to the otherside of the image. 
        </p>
        <p>The offsets of each color channel for aligning the image is listed below the image. (Notice also that the blue shift is always (0, 0). This is because, as mentioned earlier, the blue channel is my base channel, while the red and green align on that)</p>
        <div class = "image-row">
            <div class = "image-row">
                <figure>
                <h3>monastery.jpg</h3>
                <img src = "./images restored (ncc)/Red (2, 3) || Green (2, -3) || Blue (0, 0) monastery.jpg" width="400">
                <figcaption>Red (2, 3) || Green (2, -3) || Blue (0, 0)</figcaption>
                </figure>
                <!-- <figure>
                <img src = "./images restored (sobel and ncc)/Red (2, 3) || Green (2, -3) || Blue (0, 0) monastery.jpg" width="400">
                <figcaption>Red (2, 3) || Green (2, -3) || Blue (0, 0)</figcaption>
                </figure> -->
            </div>
            <div class = "image-row">
                <figure>
                <h3>cathedral.jpg</h3>
                <img src = "./images restored (ncc)/Red (3, 12) || Green (2, 5) || Blue (0, 0) cathedral.jpg" width="400">
                <figcaption>Red (3, 12) || Green (2, 5) || Blue (0, 0)</figcaption>
                </figure>
                <!-- <figure>
                <img src = "./images restored (sobel and ncc)/Red (3, 12) || Green (2, 5) || Blue (0, 0) cathedral.jpg" width="400">
                <figcaption>Red (3, 12) || Green (2, 5) || Blue (0, 0)</figcaption>
                </figure> -->
            </div>
            <div class = "image-row">
                <figure>
                <h3>tobolsk.jpg</h3>
                <img src = "./images restored (ncc)/Red (3, 7) || Green (3, 3) || Blue (0, 0) tobolsk.jpg" width="400">
                <figcaption>Red (3, 7) || Green (3, 3) || Blue (0, 0)</figcaption>
                </figure>
                <!-- <figure>
                <img src = "./images restored (sobel and ncc)/Red (3, 7) || Green (3, 3) || Blue (0, 0) tobolsk.jpg" width="400">
                <figcaption>Red (3, 7) || Green (3, 3) || Blue (0, 0)</figcaption>
                </figure> -->
            </div>
        </div>
    <h2>Multi-scale pyramid alignment</h2>
        <p>
            For this task, simply cross corrolating the images was not going work. This is because the following images are too big, and therefore it would take a long time to use NCC on these. 
            Instead, what I had to do was to use an image pyramid. An image pyramid recursively reduces the image size by a chosen factor with a gaussian filter until it comes up with an image that is small enough to be computationally effecient.
            This way, you can do the bulk of your computations on the smalles image, and then make some adjustments as you move up your pyramid to account for the bigger images.
            Here is a visual depiction of an image pyramid
        </p>
        <img src="./webpage images/pyramid_example.png" style="display: block; margin: 0 auto; max-width: 30%; height: auto;">
        <p>
            Although the image pyramid proved to be a good strategy, this unfortunately did not work well on all of my images (in particular, see emir.tif and melon.tif)
            I decided to fix this by using the sobel feature of skimage. This is a pixel intensity derivative calculator. What this means it results in high values for any regions that have a sudden jump in pixel intensity, and low negative values for for any regions that have a sudden drop in pixel intensity.
            Intuitively, this is just an edge detector. The sobel method of skimage calculates boht the x and y partial derivatives by convolving the image with the following matrices, and then merges the outputs into one image that displays both edges along the x and y direction with the following function.
            The NCC, which I formerly applied on the raw pixel intensities before, were now being applied to the outcome of the "Magnitude" function of the edge detector"
        </p>
        <div class = "image-row">
            <figure>
                <img src="./webpage images/sobmasks.gif" width="400">
            </figure>
            <figure>
                <img src="./webpage images/sobel magnitude.png" width="400">
            </figure>
        </div>
        <p>The images with the image pyramid are shown to the left, and the images with both the image pyramid and edge detector are shown to the right</p>
        <h3>siren.tif</h3>
            <div class="image-row">
                <figure>
                <img src="./images restored (ncc)/Red (-23, 97) || Green (-5, 49) || Blue (0, 0) siren.png" width="400">
                <figcaption>Red (-23, 97) || Green (-5, 49) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                    <img src="./images restored (sobel and ncc)/Red (-23, 97) || Green (-5, 49) || Blue (0, 0) siren.png" width="400">
                    <figcaption>Red (-23, 97) || Green (-5, 49) || Blue (0, 0)</figcaption>
                    </figure>
            </div>
        <h3>emir.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (-277, 161) || Green (24, 48) || Blue (0, 0) emir.png" width="400">
                <figcaption>Red (-277, 161) || Green (24, 48) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (41, 107) || Green (24, 49) || Blue (0, 0) emir.png" width="400">
                <figcaption>Red (41, 107) || Green (24, 49) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>lugano.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (-28, 93) || Green (-15, 40) || Blue (0, 0) lugano.png" width="400">
                <figcaption>Red (-28, 93) || Green (-15, 40) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (-29, 93) || Green (-15, 40) || Blue (0, 0) lugano.png" width="400">
                <figcaption>Red (-29, 93) || Green (-15, 40) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>church.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (-4, 58) || Green (4, 25) || Blue (0, 0) church.png" width="400">
                <figcaption>Red (-4, 58) || Green (4, 25) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (-4, 58) || Green (4, 25) || Blue (0, 0) church.png" width="400">
                <figcaption>Red (-4, 58) || Green (4, 25) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>lastochikino.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (-8, 75) || Green (-2, -3) || Blue (0, 0) lastochikino.png" width="400">
                <figcaption>Red (-8, 75) || Green (-2, -3) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (-8, 75) || Green (-2, -3) || Blue (0, 0) lastochikino.png" width="400">
                <figcaption>Red (-8, 75) || Green (-2, -3) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>three_generations.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (12, 110) || Green (15, 50) || Blue (0, 0) three_generations.png" width="400">
                <figcaption>Red (12, 110) || Green (15, 50) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (11, 110) || Green (13, 51) || Blue (0, 0) three_generations.png" width="400">
                <figcaption>Red (11, 110) || Green (13, 51) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>melons.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (13, 181) || Green (-119, 92) || Blue (0, 0) melons.png" width="400">
                <figcaption>Red (13, 181) || Green (-119, 92) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (13, 178) || Green (10, 82) || Blue (0, 0) melons.png" width="400">
                <figcaption>Red (13, 178) || Green (10, 82) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>harvesters.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (15, 124) || Green (17, 59) || Blue (0, 0) harvesters.png" width="400">
                <figcaption>Red (15, 124) || Green (17, 59) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (14, 124) || Green (17, 59) || Blue (0, 0) harvesters.png" width="400">
                <figcaption>Red (14, 124) || Green (17, 59) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>icon.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (23, 90) || Green (18, 41) || Blue (0, 0) icon.png" width="400">
                <figcaption>Red (23, 90) || Green (18, 41) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (23, 90) || Green (18, 41) || Blue (0, 0) icon.png" width="400">
                <figcaption>Red (23, 90) || Green (18, 41) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>italil.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (36, 77) || Green (22, 38) || Blue (0, 0) italil.png" width="400">
                <figcaption>Red (36, 77) || Green (22, 38) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (36, 76) || Green (22, 38) || Blue (0, 0) italil.png" width="400">
                <figcaption>Red (36, 76) || Green (22, 38) || Blue (0, 0)</figcaption>
                </figure>
            </div>
        <h3>self_portrait.tif</h3>
            <div class = "image-row">
                <figure>
                <img src = "./images restored (ncc)/Red (37, 175) || Green (29, 77) || Blue (0, 0) self_portrait.png" width="400">
                <figcaption>Red (37, 175) || Green (29, 77) || Blue (0, 0)</figcaption>
                </figure>
                <figure>
                <img src = "./images restored (sobel and ncc)/Red (37, 175) || Green (29, 78) || Blue (0, 0) self_portrait.png" width="400">
                <figcaption>Red (37, 175) || Green (29, 78) || Blue (0, 0)</figcaption>
                </figure>
            </div>
</body>
</html>